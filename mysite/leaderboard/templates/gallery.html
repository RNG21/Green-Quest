{% for task in tasks %}
<div>
    <img src="{{ task.image.url }}" alt="{{ task.title }}">
    <p>{{ task.description }}</p>
    <button class="like-btn" data-task-id="{{ task.id }}">Like</button>
    <span>{{ task.total_like }} Likes</span>
</div>
{% endfor %}

<script>

document.querySelectorAll('.like-btn').forEach(button => {
    button.addEventListener('click', function() {
        const taskId = this.getAttribute('data-task-id');
        fetch('/like-image/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `task_id=${taskId}`
        })
        .then(response => response.json())
        .then(data => {
            this.nextElementSibling.innerText = `${data.total_likes} Likes`;
            this.innerText = data.is_liked ? 'Unlike' : 'Like';
        });
    });
});
</script>